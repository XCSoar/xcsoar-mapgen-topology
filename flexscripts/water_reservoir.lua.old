-- Flex output script for importing natural=water or landuse=reservoir polygons

-- Create a table for the filtered features
local water_reservoir_table = osm2pgsql.define_node_table("water_reservoir_nodes", 
    {   
        { column = "osm_id", type = "bigint" },
        { column = "geom", type = "geometry" },
        { column = "natural", type = "text" },
        { column = "landuse", type = "text" }
    }
)

-- Filter function to select desired features
function filter_tags(tags, num_tags)
    -- Check if the feature has the desired tags
    if tags["natural"] == "water" or tags["landuse"] == "reservoir" then
        return 1 -- Include the feature
    else
        return 0 -- Exclude the feature
    end
end

-- Output function for filtered features
function output_tags(tags, num_tags, geom)
    -- Output the feature with its tags and geometry
    water_reservoir_nodes:add_row{
        geom = geom,
        natural = tags["natural"],
        landuse = tags["landuse"]
    }
end

